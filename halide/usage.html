
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Usage Instructions · The Ultimate Documentation for CGRAFlow</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.6.21">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="halide-basics.html" />
    
    
    <link rel="prev" href="installation.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../overview/toolchain.html">
            
                <a href="../overview/toolchain.html">
            
                    
                    Tool Chain Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../cgra/cgra-generator.html">
            
                <a href="../cgra/cgra-generator.html">
            
                    
                    CGRA Generator
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../cgra/pe-spec.html">
            
                <a href="../cgra/pe-spec.html">
            
                    
                    PE Spec
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="intro.html">
            
                <a href="intro.html">
            
                    
                    Halide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="installation.html">
            
                <a href="installation.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2" data-path="usage.html">
            
                <a href="usage.html">
            
                    
                    Usage Instructions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="halide-basics.html">
            
                <a href="halide-basics.html">
            
                    
                    Halide Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="writing-apps.html">
            
                <a href="writing-apps.html">
            
                    
                    Writing Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="writing-schedules.html">
            
                <a href="writing-schedules.html">
            
                    
                    Writing Schedules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3" data-path="operations.html">
            
                <a href="operations.html">
            
                    
                    Supported Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.4" data-path="application-list.html">
            
                <a href="application-list.html">
            
                    
                    Application List
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="compilation.html">
            
                <a href="compilation.html">
            
                    
                    Compilation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.1" data-path="hardware-lowering.html">
            
                <a href="hardware-lowering.html">
            
                    
                    Hardware Lowering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.2" data-path="codegen.html">
            
                <a href="codegen.html">
            
                    
                    Code Generation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="testing.html">
            
                <a href="testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../coreir/intro.html">
            
                <a href="../coreir/intro.html">
            
                    
                    CoreIR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../pnr/intro.html">
            
                <a href="../pnr/intro.html">
            
                    
                    Place and Route
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../pnr/packing.html">
            
                <a href="../pnr/packing.html">
            
                    
                    Packing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../pnr/placement.html">
            
                <a href="../pnr/placement.html">
            
                    
                    Placement
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="../pnr/global-placement.html">
            
                <a href="../pnr/global-placement.html">
            
                    
                    Global Placement
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="../pnr/detailed-placement.html">
            
                <a href="../pnr/detailed-placement.html">
            
                    
                    Detailed Placement
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../pnr/routing.html">
            
                <a href="../pnr/routing.html">
            
                    
                    Routing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="../pnr/global-routing.html">
            
                <a href="../pnr/global-routing.html">
            
                    
                    Global Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="../pnr/detailed-routing.html">
            
                <a href="../pnr/detailed-routing.html">
            
                    
                    Detailed Routing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../pnr/bitstream-gen.html">
            
                <a href="../pnr/bitstream-gen.html">
            
                    
                    Bitstream Generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../pnr/testing.html">
            
                <a href="../pnr/testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../pnr/analysis.html">
            
                <a href="../pnr/analysis.html">
            
                    
                    Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../pnr/retiming.html">
            
                <a href="../pnr/retiming.html">
            
                    
                    Retiming
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../bsbuilder/bsbuilder.html">
            
                <a href="../bsbuilder/bsbuilder.html">
            
                    
                    Assembler (BSBuilder)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../bsbuilder/bitstream-spec.html">
            
                <a href="../bsbuilder/bitstream-spec.html">
            
                    
                    Bitstream Specification
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../simulator/simulator.html">
            
                <a href="../simulator/simulator.html">
            
                    
                    Simulator (run_tbg)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../tbg/intro.html">
            
                <a href="../tbg/intro.html">
            
                    
                    Test Bench Generator
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../tbg/harness_generation.html">
            
                <a href="../tbg/harness_generation.html">
            
                    
                    Harness Generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../tbg/io-json.html">
            
                <a href="../tbg/io-json.html">
            
                    
                    .io.json format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../tbg/pre_post_processing.html">
            
                <a href="../tbg/pre_post_processing.html">
            
                    
                    Pre/Post Processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../tbg/roadmap.html">
            
                <a href="../tbg/roadmap.html">
            
                    
                    Roadmap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Usage Instructions</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="usage">Usage</h1>
<h2 id="installation">Installation</h2>
<p>See <a href="installation.html">Installation</a> section for how to install
dependencies and how to compile Halide.</p>
<h2 id="applications">Applications</h2>
<p>The applications for the Halide-to-Hardware repo exist in <code>apps/hardware_examples/apps</code>
and <code>apps/hardware_examples/tests</code> where the distinction is that tests tend to focus
on a much narrower scope as compared to apps.</p>
<p>For the Halide-to-Hardware repo, the targets are build into a series of small steps.
The basic steps are: <code>make clean</code>, <code>make clockwork</code>, and <code>make bin/output_clockwork.png</code>.
Some targets are duplicated with new target names. The definition
of all of these targets can be found in <code>apps/hardware_benchmarks/hw_support/hardware_targets.mk</code>.</p>
<pre><code class="lang-make">make clean                     <span class="hljs-comment"># remove generated files (bin directory)</span>
     compiler                  <span class="hljs-comment"># compile updates to Halide compiler</span>
     generator                 <span class="hljs-comment"># create Halide generator</span>
     design-clockwork          <span class="hljs-comment"># create Clockwork design</span>
     design-cpu                <span class="hljs-comment"># create CPU design</span>
     bin/output_cpu.png        <span class="hljs-comment"># create output file using CPU implementation</span>
     run-cpu                   <span class="hljs-comment"># create output file using CPU implementation</span>
     bin/output_clockwork.png  <span class="hljs-comment"># create output file using Clockwork implementation</span>
     run-clockwork             <span class="hljs-comment"># create output file using Clockwork implementation</span>
     compare-clockwork-cpu     <span class="hljs-comment"># compare Clockwork output file to CPU output image</span>
     golden                    <span class="hljs-comment"># update reference CoreIR json file and output image</span>
     mem                       <span class="hljs-comment"># run the Clockwork compiler and create design_top.json</span>
     memtest                   <span class="hljs-comment"># test the full Clockwork/CoreIR application using verilator</span>
</code></pre>
<h2 id="application-folder">Application Folder</h2>
<p>The following is a list of the files that are important for generating
images and are used further in the flow. The CoreIR json files are created
for mapping to the CGRA. Also, an output image, <code>output_cpu.png</code>, is generated as a 
the reference image to determine if execution is correct. <code>output_cpu.png</code> is 
created using a CPU implementation of Halide, and its output should be
used for validation during CoreIR interpretation and CGRA simulation.</p>
<h3 id="directory-for-halide-to-hardware-repository">Directory for Halide-to-Hardware repository</h3>
<pre><code>Halide_CoreIR
└── apps
    └── hardware_benchmarks                      // contains simpler test cases
        ├── apps                                 // contains all apps compiled to Clockwork
        └── tests                                // contains all simpler test cases
            └── conv_3_3                         // one of the tests: does 3x3 convolution
                ├── Makefile                     // specifies commands for &apos;make&apos;
                ├── conv_3_3_generator.cpp       // contains Halide algorithm and schedule
                ├── input.png                    // input image for testing
                ├── process.cpp                  // runs input image with design to create ouput image
                ├── golden                       // this holds all expected output files
                │   └── golden_output.png        // output image expected
                │                                
                └── bin                          //// Running &apos;make all&apos; generates in this folder:
                    ├── design_top.json          // generated CoreIR design after Clockwork mapping
                    ├── conv_3_3_memory.cpp      // generated Clockwork memory file
                    ├── conv_3_3_compute.json    // generated CoreIR compute kernels
                    ├── clockwork_testscript.cpp // generated script used to run the Clockwork files
                    ├── output_cpu.png           // output image created using CPU implementation
                    └── output_clockwork.png     // output image created during testing; should be equivalent to output_cpu.png
</code></pre><h2 id="running-multiple-applications">Running Multiple Applications</h2>
<p>In order to run multiple tests, the Makefile in the tests or apps directory is used. There
are a couple of make targets specifically to run on all tests, such as:</p>
<pre><code>  make list      # list all of the tests, and which tests are not classified into a test suite
  make check     # check each test for generated coreir, generated ubuffers, correct output
  make cleanall  # clean bin folders for each test
  make suites    # list all of the suites that exist
</code></pre><p>The make targets in these directories run their associated target in individual tests.
For example, to generate the coreir for conv_3_3, one can run:</p>
<pre><code class="lang-sh">  <span class="hljs-built_in">cd</span> apps/hardware_targets/tests
  make conv_3_3-clockwork
</code></pre>
<p>This results in conv_3_3 creating the Clockwork files, which then creates the
Clockwork output file, <code>tests/conv_3_3/bin/conv_3_3_memory.cpp</code>. Note that the
output is silent besides a FAILED/PASSED. To run with debug output, change
to the desired directory and run <code>make clockwork</code> there.</p>
<p>Test targets are:</p>
<pre><code class="lang-sh">  make conv_3_3-clockwork <span class="hljs-comment"># create Clockwork hardware design (conv_3_3_memory.cpp)</span>
               -run-cpu   <span class="hljs-comment"># create output image using the CPU (output_cpu.png)</span>
               -compare   <span class="hljs-comment"># compare Clockwork output image and CPU output image. If matching, save as output.png</span>
               -check     <span class="hljs-comment"># check for generated Clockwork, CPU, and correct output images</span>
               -clean     <span class="hljs-comment"># delete bin folder for the test</span>
</code></pre>
<p>Besides individual tests, one can run a command on multiple tests. The
tests are grouped into different test suites. The test suites are:</p>
<pre><code>  all     # all tests in a sorted order
  ops     # single operators, such as + &lt; &amp;&amp;
  fpops   # single operators using floating point, such as f+ f&lt; sin exp
  conv    # convolutions of different sizes
  fpconv  # convolutions of different sizes using floating point numbers
  inout   # tests of the interface, such as two inputs, bit input, floating point output
  mem     # tests of the memory tile, such as ROM, downsample, accumulation
</code></pre><p>For example, to run a comparison to check Clockwork correctness on the convolutions, use;</p>
<pre><code>  make conv-compare
</code></pre><p>Note that parallelism works with these targets, so to run the convolutions in parallel:</p>
<pre><code>  make conv-compare -j8
</code></pre><p>A list of all of the Makefile targets can be found in <code>apps/hardware_benchmarks/include.mk</code>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="installation.html" class="navigation navigation-prev " aria-label="Previous page: Installation">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="halide-basics.html" class="navigation navigation-next " aria-label="Next page: Halide Basics">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Usage Instructions","level":"1.4.2","depth":2,"next":{"title":"Halide Basics","level":"1.4.3","depth":2,"path":"halide/halide-basics.md","ref":"halide/halide-basics.md","articles":[{"title":"Writing Applications","level":"1.4.3.1","depth":3,"path":"halide/writing-apps.md","ref":"halide/writing-apps.md","articles":[]},{"title":"Writing Schedules","level":"1.4.3.2","depth":3,"path":"halide/writing-schedules.md","ref":"halide/writing-schedules.md","articles":[]},{"title":"Supported Operations","level":"1.4.3.3","depth":3,"path":"halide/operations.md","ref":"halide/operations.md","articles":[]},{"title":"Application List","level":"1.4.3.4","depth":3,"path":"halide/application-list.md","ref":"halide/application-list.md","articles":[]}]},"previous":{"title":"Installation","level":"1.4.1","depth":2,"path":"halide/installation.md","ref":"halide/installation.md","articles":[]},"dir":"ltr"},"config":{"plugins":["mathjax","expandable-chapters"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"mathjax":{"forceSVG":false,"version":"2.6.1"},"expandable-chapters":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"The Ultimate Documentation for CGRAFlow","gitbook":"*"},"file":{"path":"halide/usage.md","mtime":"2021-09-17T17:10:48.331Z","type":"markdown"},"gitbook":{"version":"3.6.21","time":"2021-09-17T17:11:09.351Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

